"use strict";(self.webpackChunkapp_coin=self.webpackChunkapp_coin||[]).push([[848],{848:(e,t,n)=>{n.r(t),n.d(t,{render:()=>_});var i=n(5877),s=n(4306),c=n(5382),a=n.n(c),o=n(5331),r=n.n(o),l=n(2627),d=n(5253);async function m(e){e.innerHTML="";const t=(0,i.el)("div.coin-list.card-curriences"),n=(0,i.el)("h2.coin-list__title.card-curriences__title.title-card.gap-reset","Ваши валюты"),c=(0,i.el)("div.coin-list__list-wrapper.currencies-list-wrapper"),a=(0,i.el)("ul.coin-list__list.currencies__list");(0,i.IX)(c,a);const o=sessionStorage.getItem("token");l.appSpinner.show(),d.appMessage.hide();let m=null;try{m=await(0,s.getListCurrencies)(o),l.appSpinner.hide()}catch{l.appSpinner.hide(),d.appMessage.show(),d.appMessage.text.textContent="Ошибка свяи с сервером."}let _=null;if(m&&!m.error){_=m.payload;let e=new Intl.NumberFormat("ru",{maximumFractionDigits:10});for(const t in _){const n=(0,i.el)("li.coin-list__list-item.currencies__list-item",[(0,i.el)("p.coin-list__list-item-name.currencies__list-item-name",[(0,i.el)("span.coin-list__list-item-name-text.currencies__list-item-name-text",`${_[t].code}`)]),(0,i.el)("p.coin-list__list-item-amount.currencies__list-item-amount",`${e.format(_[t].amount)}`)]);_[t].amount>0&&(0,i.LI)(a,n)}}return(0,i.IX)(t,n,c),new(r())(c,{autoHide:!0}),(0,i.IX)(e,t),t}async function _(){const e=(0,i.el)("section.coin-tools"),t=(0,i.el)("div.coin-tools__container.container"),n=(0,i.el)("h2.coin-tools__title.gap-reset.title.title-ptb","Валютный обмен"),c=(0,i.el)("div.coin-tools__grid-wrapper"),o=(0,i.el)("div.coin-tools__grid"),_=(0,i.el)("div.coin-tools__grid-item",{id:"coinList"}),p=(0,i.el)("div.coin-tools__grid-item",{id:"coinRealTime"}),g=(0,i.el)("div.coin-tools__grid-item",{id:"coinExchange"});return(0,i.IX)(c,o),(0,i.IX)(o,_,p,g),await m(_),function(e){e.innerHTML="";const t=(0,i.el)("div.coin-rt.card-curriences"),n=(0,i.el)("h2.coin-rt__title.card-curriences__title.title-card.gap-reset","Изменение курсов в реальном времени"),c=(0,i.el)("div.coin-rt__list-wrapper.currencies-list-wrapper"),a=(0,i.el)("ul.coin-rt__list.currencies__list");(0,i.IX)(c,a);let o=new Intl.NumberFormat("ru",{maximumFractionDigits:10});(0,s.wsConnCurrencyFeed)().addEventListener("message",(()=>{const e=JSON.parse(event.data);if("EXCHANGE_RATE_CHANGE"===e.type){const t=`${e.from}/${e.to}`,n={"-1":".dw",0:"",1:".up"},s={"-1":"dw",0:"",1:"up"};if(document.getElementById(t)){const n=document.getElementById(`name_${t}`),i=document.getElementById(`rate_${t}`);n.classList.remove("up","dw"),i.classList.remove("up","dw"),n.classList.add(`${s[String(e.change)]}`),i.classList.add(`${s[String(e.change)]}`),i.textContent=`${o.format(e.rate)}`}else{const s=(0,i.el)("li.coin-rt__list-item.currencies__list-item",[(0,i.el)("p.coin-rt__list-item-name.currencies__list-item-name",[(0,i.el)(`span.coin-rt__list-item-name-text.currencies__list-item-name-text${n[String(e.change)]}`,`${t}`,{id:`name_${t}`})]),(0,i.el)(`p.coin-rt__list-item-amount.currencies__list-item-rate${n[String(e.change)]}`,`${o.format(e.rate)}`,{id:`rate_${t}`})],{id:`${t}`});(0,i.LI)(a,s,a.firstChild)}}})),(0,i.IX)(t,n,c),new(r())(c,{autoHide:!0}),(0,i.IX)(e,t)}(p),await async function(e){sessionStorage.getItem("token"),e.innerHTML="";const t=(0,i.el)("div.coin-exchange"),n=(0,i.el)("h2.coin-exchange__title.title-card.gap-reset","Обмен валюты"),c=(0,i.el)("form.coin-exchange__form"),o=(0,i.el)("div.coin-exchange__form-left-top"),_=(0,i.el)("div.coin-exchange__form-left-bottom"),p=(0,i.el)("div.coin-exchange__form-right");(0,i.IX)(c,o,p,_);const g=(0,i.el)("div.coin-exchange__form-group"),u=(0,i.el)("lable.coin-exchange__form-lable","Из"),h=(0,i.el)("div.coin-exchange__form-choice-wrapper.custom-choice"),v=(0,i.el)("select.coin-exchange__form-choice.custom-choice__select.choice",{id:"coinExchangeFrom"});(0,i.IX)(h,v),v.dataset.name="coinExchangeFrom",(0,i.IX)(g,u,h);const x=(0,i.el)("div.coin-exchange__form-group"),f=(0,i.el)("lable.coin-exchange__form-lable","в"),w=(0,i.el)("div.coin-exchange__form-choice-wrapper.custom-choice"),E=(0,i.el)("select.coin-exchange__form-choice.custom-choice.custom-choice__select.choice",{id:"coinExchangeTo"});(0,i.IX)(w,E),E.dataset.name="coinExchangeTo",(0,i.IX)(x,f,w);const I=(0,i.el)("div.coin-exchange__form-group"),L=(0,i.el)("lable.coin-exchange__form-lable.coin-exchange__form-lable-lb","Сумма"),b=(0,i.el)("input.coin-exchange__form-input.input",{id:"coinExchangeAmount",type:"text"});b.dataset.name="coinExchangeAmount",a()("9{1,20}[.9{1,20}]").mask(b),(0,i.IX)(I,L,b);const C=(0,i.el)("div.coin-exchange__form-group"),X=(0,i.el)("a.coin-exchange__form-btn.link-reset.btn.btn-fill","Обменять",{id:"coinExchangeBtn"});X.dataset.name="coinExchangeBtn",(0,i.IX)(C,X);const y=(0,i.el)("div.coin-exchange__message-group"),S=(0,i.el)("div.coin-exchange__message",{id:"coinExchangeMessage"});function $(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];h.classList.remove("is-invalid"),w.classList.remove("is-invalid"),b.classList.remove("is-invalid"),S.classList.remove("message-error","message-success"),e||(b.value=""),S.textContent=""}(0,i.IX)(y,S),(0,i.IX)(o,g,x),(0,i.IX)(_,I),(0,i.IX)(p,C),(0,i.IX)(t,n,c,y),(0,i.IX)(e,t);const k={searchEnabled:!1,position:"bottom",placeholder:!1,itemSelectText:"",sorter:()=>{}},M=(await async function(){let e=[];l.appSpinner.show(),d.appMessage.hide();try{const t=await(0,s.allCurrencies)();l.appSpinner.hide(),t.payload.forEach((t=>{e.push({value:t,label:t,selected:!1})})),e&&e.length>0&&(e[0].selected=!0)}catch(e){l.appSpinner.hide(),d.appMessage.show(),d.appMessage.text.textContent="Ошибка свяи с сервером."}return{list:e,error:""}}()).list,F=new Choices(v,k);F.setChoices(M,"value","label",!0),new(r())(F.dropdown.element,{autoHide:!0}),F.passedElement.element.addEventListener("showDropdown",(()=>$()));const T=new Choices(E,k);return T.setChoices(M,"value","label",!0),new(r())(T.dropdown.element,{autoHide:!0}),T.passedElement.element.addEventListener("showDropdown",(()=>$())),b.addEventListener("focus",(()=>{$()})),c.addEventListener("click",(e=>{e._isClickForm=!0})),window.addEventListener("click",(e=>{e._isClickForm||$()})),X.addEventListener("click",(async e=>{e.preventDefault();const t={},n={};l.appSpinner.show(),d.appMessage.hide(),$(!0);for(let e=0;e<c.elements.length;++e){const i=c[e];i.hasAttribute("data-name")&&(S[i.dataset.nameMessage]=i,i.value=i.value.trim(),t[i.dataset.name]=i.value,n[i.dataset.name]=i)}try{const e=sessionStorage.getItem("token"),n={from:t.coinExchangeFrom,to:t.coinExchangeTo,amount:Number(t.coinExchangeAmount)};await(0,s.currencyBuy)(e,n.from,n.to,n.amount),l.appSpinner.hide(),d.appMessage.hide(),await m(document.getElementById("coinList")),S.textContent="Обмен валюты выполнен!",S.classList.add("message-success"),setTimeout((()=>{$()}),1e3)}catch(e){if(l.appSpinner.hide(),"ErrorCoinExchange"===e.name){switch(e.messages.name){case"invalidCode":h.classList.add("is-invalid"),w.classList.add("is-invalid");break;case"invalidAmount":case"notCurrency":case"overdraftPrevented":b.classList.add("is-invalid")}S.textContent=e.messages.message,S.classList.add("message-error")}else d.appMessage.show(),d.appMessage.text.textContent="Ошибка свяи с сервером."}})),t}(g),(0,i.IX)(t,n,c),(0,i.IX)(e,t),e}}}]);