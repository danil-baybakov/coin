"use strict";(self.webpackChunkapp_coin=self.webpackChunkapp_coin||[]).push([[690,306],{4306:(e,t,n)=>{n.r(t),n.d(t,{ErrorAuth:()=>o,ErrorCoinExchange:()=>i,ErrorGetAccount:()=>s,ErrorTransfer:()=>c,InvalidAuth:()=>r,InvalidTransfer:()=>a,allCurrencies:()=>m,authorization:()=>l,createAccount:()=>p,currencyBuy:()=>g,getAccount:()=>h,getAccounts:()=>u,getBanks:()=>f,getListCurrencies:()=>w,transferFunds:()=>d,wsConnCurrencyFeed:()=>_});class r extends Error{name="InvalidAuth"}class o extends Error{name="ErrorAuth"}class s extends Error{name="ErrorGetAccount"}class a extends Error{name="InvalidTransfer"}class c extends Error{name="ErrorTransfer"}class i extends Error{name="ErrorCoinExchange"}async function l(e){const t=[];if(e.login?e.login.includes(" ")?t.push({name:"login",message:"Логин не должен содержать пробелы."}):e.login.length<6&&t.push({name:"login",message:"Длинна логина не может быть меньше 6 символов."}):t.push({name:"login",message:"Логин не введен."}),e.password?e.password.includes(" ")?t.push({name:"password",message:"Пароль не должен содержать пробелы."}):e.password.length<6&&t.push({name:"password",message:"Длинна пароля не может быть меньше 6 символов."}):t.push({name:"password",message:"Пароль не введен."}),t.length){const e=new r;throw e.errors=t,e}const n=await fetch("http://localhost:3000/login",{method:"POST",body:JSON.stringify({login:e.login,password:e.password}),headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error;const s=await n.json();if(s.error){const e=new o;throw e.error={name:"submit",message:"Invalid password"===s.error?"Пытаемся войти с неверным паролем":"Такой пользователь не зарегестрирован."},e}return s}async function u(e){const t=await fetch("http://localhost:3000/accounts",{method:"GET",headers:{Authorization:`Basic ${e}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error;return await t.json()}async function h(e,t){const n=await fetch(`http://localhost:3000/account/${t}`,{method:"GET",headers:{Authorization:`Basic ${e}`,"Content-Type":"application/json"}});if(!n.ok)throw new Error;const r=await n.json();if(r.error)throw new s;return r}async function p(e){const t=await fetch("http://localhost:3000/create-account",{method:"POST",headers:{Authorization:`Basic ${e}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error;return await t.json()}async function d(e,t,n,r){const o=new a;if(!t||!n||!r){if(!t)throw o.errorMessages={name:"submit",message:"Не указан адрес счёта списания, или этот счёт не принадлежит нам"},o;if(!n)throw o.errorMessages={name:"number",message:"Не указан счёт зачисления, или этого счёта не существует"},o;if(!r)throw o.errorMessages={name:"amount",message:"Не указана сумма перевода, или она отрицательная"},o}const s=await fetch("http://localhost:3000/transfer-funds",{method:"POST",body:JSON.stringify({from:t,to:n,amount:r}),headers:{Authorization:`Basic ${e}`,"Content-Type":"application/json"}});if(!s.ok)throw new Error;const c=await s.json();if(c.error)throw"Invalid account from"===c.error?o.errorMessages={name:"submit",message:"Не указан адрес счёта списания, или этот счёт не принадлежит нам"}:"Invalid account to"===c.error?o.errorMessages={name:"number",message:"Не указан счёт зачисления, или этого счёта не существует"}:"Invalid amount"===c.error?o.errorMessages={name:"amount",message:"Не указана сумма перевода, или она отрицательная"}:"Overdraft prevented"===c.error&&(o.errorMessages={name:"amount",message:"Мы попытались перевести больше денег, чем доступно на счёте списания"}),o;return c}async function m(){const e=await fetch("http://localhost:3000/all-currencies");if(!e.ok)throw new Error;return await e.json()}async function w(e){const t=await fetch("http://localhost:3000/currencies",{method:"GET",headers:{Authorization:`Basic ${e}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error;return await t.json()}async function g(e,t,n,r){const o=await fetch("http://localhost:3000/currency-buy",{method:"POST",body:JSON.stringify({from:t,to:n,amount:r}),headers:{Authorization:`Basic ${e}`,"Content-Type":"application/json"}});if(!o.ok)throw new Error;const s=await o.json();if(s.error||!r){const e=new i;throw"Unknown currency code"===s.error?e.messages={name:"invalidCode",message:"Передан неверный валютный код, код не поддерживается системой (валютный код списания или валютный код зачисления)."}:"Invalid amount"!==s.error&&r?"Not enough currency"===s.error?e.messages={name:"notCurrency",message:"На валютном счёте списания нет средств."}:"Overdraft prevented"===s.error&&(e.messages={name:"overdraftPrevented",message:"Попытка перевести больше, чем доступно на счёте списания."}):e.messages={name:"invalidAmount",message:"Не указана сумма перевода, или она отрицательная."},e}return s}async function f(){const e=await fetch("http://localhost:3000/banks");if(!e.ok)throw new Error;return await e.json()}function _(){return new WebSocket("ws://localhost:3000/currency-feed")}},9690:(e,t,n)=>{n.r(t),n.d(t,{render:()=>h});var r=n(5877),o=n(4306),s=n(8575),a=n(2627),c=n(5253);function i(e){const t=e.transactions.length>0?new Date(e.transactions[e.transactions.length-1].date):null,n=(0,r.el)("li.user__item"),o=(0,r.el)("div.user__card");(0,r.IX)(n,o);const a=(0,r.el)("p.user__card-title.gap-reset",`${e.account}`),c=(0,r.el)("p.user__card-price.ruble.gap-reset",`${Number(e.balance.toFixed(2))}`),i=(0,r.el)("div.user__card-bottom-content"),l=(0,r.el)("div.user__card-bottom-content-left"),u=(0,r.el)("h2.user__card-bottom-content-left-title.gap-reset","Последняя транзакция:"),h=(0,r.el)("time.user__card-bottom-content-left-time.gap-reset",`${(0,s.parseTransactionDate)(t)}`);(0,r.IX)(l,u,h);const p=(0,r.el)("a.user__card-btn.link-reset.btn.btn-fill",{id:`btnAccountOpen-${e.account}`,href:"#"},"Открыть");return p.addEventListener("click",(t=>{t.preventDefault(),history.pushState(null,"",`/account-view?id=${e.account}`),(0,s.renderElement)("account",document.querySelector("#appContainer"),{id:e.account,page:"view"})})),(0,r.IX)(i,l,p),(0,r.IX)(o,a,c,i),n}function l(e){let t=null;document.querySelector("ul.user__list")?(t=document.querySelector("ul.user__list"),t.innerHTML=""):t=(0,r.el)("ul.user__list.list-reset");for(const n of e)(0,r.LI)(t,i(n));return t}function u(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Сортировка";const n=e,r=[...n];switch(t){case"Сортировка":return n;case"По номеру":return r.sort(((e,t)=>Number(e.account)-Number(t.account)));case"По балансу":return r.sort(((e,t)=>Number(e.balance)-Number(t.balance)));case"По последней транзакции":return r.sort(((e,t)=>{const n=new Date(e.transactions.length>0?e.transactions[e.transactions.length-1].date:new Date("2000-01-01"));return new Date(t.transactions.length>0?t.transactions[t.transactions.length-1].date:new Date("2000-01-01"))-n})),r;default:return r}}async function h(){const e=sessionStorage.getItem("token");a.appSpinner.show(),c.appMessage.hide();let t=[],n={};try{n=await(0,o.getAccounts)(e),t=n.payload,a.appSpinner.hide()}catch{a.appSpinner.hide(),c.appMessage.show(),c.appMessage.text.textContent="Ошибка свяи с сервером."}let s="Сортировка";const i=(0,r.el)("section.user"),h=(0,r.el)("div.user__container.container");(0,r.IX)(i,h);const p=function(){const e=["Сортировка","По номеру","По балансу","По последней транзакции"],t=(0,r.el)("div.user__header"),n=(0,r.el)("div.user__choice"),o=(0,r.el)("h2.user__choice-title.gap-reset.title","Ваши счета"),s=(0,r.el)("div.user__choice-wrapper.custom-choice"),a=(0,r.el)("select.user__choice-select.custom-choice__select.choice");for(let t of e)(0,r.LI)(a,(0,r.el)("option.user__choice-option.custom-choice__option",{value:`${t}`},`${t}`));(0,r.IX)(s,a),(0,r.IX)(n,o,s);const c=new Choices(a,{searchEnabled:!1,position:"bottom",placeholder:!1,itemSelectText:"",sorter:()=>{}}),i=(0,r.el)("button.user__btn.btn.link-reset.btn-fill.btn-fill-icon",{id:"btnCreateAccount",type:"button"}),l=(0,r.el)("span.user__btn-icon.btn-fill__icon","Создать новый счет");l.innerHTML='<svg class="user__btn-svg btn-fill__svg" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path class="user__btn-path btn-fill__path" d="M12 4.00001L12 12M12 12L12 20M12 12L20 12M12 12L4 12" stroke="white" stroke-width="2"/>\n  </svg>\n  ';const u=(0,r.el)("span.user__btn-text.btn-fill__text","Создать новый счет");return(0,r.IX)(i,l,u),(0,r.IX)(t,n,i),{element:t,choiceObj:c,btn:i}}(),d=p.choiceObj,m=p.btn,w=l(u(t,s));return d.passedElement.element.addEventListener("change",(()=>{s=d.getValue(!0),l(u(t,s))}),!1),m.addEventListener("click",(async r=>{r.preventDefault(),a.appSpinner.show(),c.appMessage.hide();try{await(0,o.createAccount)(e),n=await(0,o.getAccounts)(e),t=n.payload,l(u(t,s)),a.appSpinner.hide()}catch{a.appSpinner.hide(),c.appMessage.show(),c.appMessage.text.textContent="Ошибка свяи с сервером."}})),(0,r.IX)(h,p.element,w),i}}}]);